# First install tox:
#
#   ./sage -i tox
#
# All tests require an installation of the non-Python components of the Sage distribution
# in SAGE_LOCAL.
#
# To build and test in the tox environment using the concrete Python dependencies specified
# by requirements.txt:
#
#   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'
#
# Afterwards, to test interactively:
#
#   build/pkgs/sagelib/src/.tox/python/bin/python
#   build/pkgs/sagelib/src/.tox/python/bin/sage
#
# To build and test without using the concrete dependencies specified by requirements.txt,
# using the dependencies declared in setup.cfg only:
#
#   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
#
[tox]

[testenv]
deps =
    !norequirements: -rrequirements.txt

    # These are dependencies of the build system (setup.py).
    # Later we will declare them using pyproject.toml
    norequirements:  Cython
    norequirements:  pkgconfig
    norequirements:  numpy

passenv =
    SAGE_LOCAL

setenv =
    # Sage scripts such as sage-runtests like to use $HOME/.sage
    HOME={envdir}

whitelist_externals =
    bash

commands =
    # Beware of the treacherous non-src layout. "./sage/" shadows the install sage package.
    python -c 'import sys; "" in sys.path and sys.path.remove(""); import sage.all; print(sage.all.__file__)'

    # We check that the "sage" script invokes the correct Python.
    sage -c 'import sys; print("sys.path =", sys.path); import sage.all; print(sage.all.__file__)'

    sage -t -p --all
